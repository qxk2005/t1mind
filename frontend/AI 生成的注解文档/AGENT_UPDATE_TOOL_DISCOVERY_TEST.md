# æ™ºèƒ½ä½“æ›´æ–°æ—¶å·¥å…·å‘ç°æµ‹è¯•æŒ‡å—

## é—®é¢˜ç°è±¡

åœ¨æ™ºèƒ½ä½“è®¾ç½®å¯¹è¯æ¡†ä¸­æ›´æ–°æ™ºèƒ½ä½“é€‰é¡¹åï¼Œæ²¡æœ‰çœ‹åˆ°å·¥å…·å‘ç°çš„æ—¥å¿—æç¤ºã€‚

## å¢å¼ºçš„è°ƒè¯•æ—¥å¿—

æˆ‘å·²ç»æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œç°åœ¨æ›´æ–°æ™ºèƒ½ä½“æ—¶ä¼šè¾“å‡ºï¼š

```
ğŸ”„ [Agent Update] å¼€å§‹æ›´æ–°æ™ºèƒ½ä½“: {agent_id}
ğŸ”„ [Agent Update] è¯·æ±‚å·¥å…·åˆ—è¡¨é•¿åº¦: X
ğŸ”„ [Agent Update] è¯·æ±‚æ˜¯å¦åŒ…å« capabilities: true/false
ğŸ”„ [Agent Update] ç°æœ‰æ™ºèƒ½ä½“: {name}
ğŸ”„ [Agent Update] ç°æœ‰å·¥å…·åˆ—è¡¨é•¿åº¦: X
ğŸ”„ [Agent Update] ç°æœ‰ enable_tool_calling: true/false
ğŸ”„ [Agent Update] æ–°èƒ½åŠ›é…ç½® - enable_tool_calling: true/false
ğŸ”„ [Agent Update] æ¡ä»¶æ»¡è¶³ï¼šå·¥å…·è°ƒç”¨å·²å¯ç”¨ä¸”å·¥å…·åˆ—è¡¨ä¸ºç©º
ğŸ”„ [Agent Update] æ˜¯å¦éœ€è¦å‘ç°å·¥å…·: true/false
```

## æµ‹è¯•æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥å½“å‰æ™ºèƒ½ä½“çŠ¶æ€

æ‰“å¼€æ™ºèƒ½ä½“è®¾ç½®å¯¹è¯æ¡†ï¼Œè®°å½•å½“å‰çŠ¶æ€ï¼š
- ä»»åŠ¡è§„åˆ’ï¼šå¼€/å…³
- å·¥å…·è°ƒç”¨ï¼šå¼€/å…³  âš ï¸ å…³é”®
- åæ€æœºåˆ¶ï¼šå¼€/å…³
- ä¼šè¯è®°å¿†ï¼šå¼€/å…³

### ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œæ›´æ–°æ“ä½œ

**æµ‹è¯•åœºæ™¯ A**ï¼šå¦‚æœå·¥å…·è°ƒç”¨å½“å‰æ˜¯**å…³é—­**çš„

1. å°†"å·¥å…·è°ƒç”¨"å¼€å…³æ‰“å¼€
2. ç‚¹å‡»"ä¿å­˜"
3. æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ”„ [Agent Update] æ–°èƒ½åŠ›é…ç½® - enable_tool_calling: true
   ğŸ”„ [Agent Update] æ¡ä»¶æ»¡è¶³ï¼šå·¥å…·è°ƒç”¨å·²å¯ç”¨ä¸”å·¥å…·åˆ—è¡¨ä¸ºç©º
   ğŸ”„ [Agent Update] æ˜¯å¦éœ€è¦å‘ç°å·¥å…·: true
   âœ¨ [Agent Update] æ£€æµ‹åˆ°å·¥å…·è°ƒç”¨èƒ½åŠ›å˜æ›´æˆ–å·¥å…·åˆ—è¡¨ä¸ºç©ºï¼Œå¼€å§‹è‡ªåŠ¨å‘ç°å·¥å…·...
   [Tool Discovery] å¼€å§‹æ‰«æ X ä¸ª MCP æœåŠ¡å™¨...
   âœ… [Agent Update] ä¸ºæ™ºèƒ½ä½“ 'XXX' è‡ªåŠ¨å‘ç°äº† X ä¸ªå·¥å…·
   ```

**æµ‹è¯•åœºæ™¯ B**ï¼šå¦‚æœå·¥å…·è°ƒç”¨å½“å‰æ˜¯**å¼€å¯**çš„

1. ä¿®æ”¹å…¶ä»–é€‰é¡¹ï¼ˆå¦‚ä»»åŠ¡è§„åˆ’ã€åæ€æœºåˆ¶ç­‰ï¼‰
2. ç‚¹å‡»"ä¿å­˜"
3. æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ”„ [Agent Update] æ–°èƒ½åŠ›é…ç½® - enable_tool_calling: true
   ```
   
   **åˆ†æ”¯åˆ¤æ–­**ï¼š
   - å¦‚æœæ™ºèƒ½ä½“å·²æœ‰å·¥å…· â†’ `â„¹ï¸ æ™ºèƒ½ä½“å·²æœ‰å·¥å…·ä¸”èƒ½åŠ›æœªå˜æ›´ï¼Œè·³è¿‡å·¥å…·å‘ç°`
   - å¦‚æœæ™ºèƒ½ä½“æ— å·¥å…· â†’ è§¦å‘å·¥å…·å‘ç°

### ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥å¯èƒ½çš„é—®é¢˜

#### é—®é¢˜ 1: æ²¡æœ‰çœ‹åˆ°ä»»ä½• `[Agent Update]` æ—¥å¿—

**åŸå› **ï¼šæ›´æ–°è¯·æ±‚å¯èƒ½æ²¡æœ‰åˆ°è¾¾ `update_agent()` æ–¹æ³•

**æ£€æŸ¥**ï¼š
```
# æŸ¥çœ‹æ˜¯å¦æœ‰è¿™è¡Œæ—¥å¿—
INFO flowy_ai::agent::event_handler: âœ… Successfully updated agent
```

å¦‚æœçœ‹åˆ°è¿™è¡Œä½†æ²¡æœ‰ `[Agent Update]` æ—¥å¿—ï¼Œè¯´æ˜æ—¥å¿—çº§åˆ«è¿‡æ»¤äº† info çº§åˆ«ã€‚

#### é—®é¢˜ 2: çœ‹åˆ° `æœªæ›´æ–°èƒ½åŠ›é…ç½®ï¼Œè·³è¿‡å·¥å…·å‘ç°`

**åŸå› **ï¼šæ›´æ–°è¯·æ±‚ä¸­æ²¡æœ‰åŒ…å« `capabilities` å­—æ®µ

**æ£€æŸ¥ Flutter UI**ï¼š
```dart
final request = UpdateAgentRequestPB()
  ..id = widget.existingAgent!.id
  ..name = name
  ..description = _descriptionController.text.trim()
  ..personality = _personalityController.text.trim()
  ..avatar = _avatarController.text.trim()
  ..capabilities = capabilities;  // âš ï¸ å¿…é¡»åŒ…å«è¿™ä¸€è¡Œ
```

#### é—®é¢˜ 3: çœ‹åˆ° `è¯·æ±‚ä¸­å·²åŒ…å« X ä¸ªå·¥å…·`

**åŸå› **ï¼šUI ä»£ç ä»ç„¶åœ¨æ·»åŠ å·¥å…·åˆ—è¡¨

**æ£€æŸ¥**ï¼šç¡®ä¿ UI ä»£ç ä¸­**æ²¡æœ‰**è¿™äº›è¡Œï¼š
```dart
..availableTools.addAll(['default_tool']);  // âŒ åº”è¯¥ç§»é™¤
..availableTools.addAll(someList);          // âŒ åº”è¯¥ç§»é™¤
```

åº”è¯¥æ˜¯ï¼š
```dart
..capabilities = capabilities;  // âœ… ä¸è®¾ç½® availableTools
```

## é¢„æœŸçš„å®Œæ•´æ—¥å¿—æµç¨‹

### ä»æ‰“å¼€å¯¹è¯æ¡†åˆ°ä¿å­˜

```
# 1. æ‰“å¼€æ™ºèƒ½ä½“è®¾ç½®å¯¹è¯æ¡†
DEBUG appflowy_flutter: Opening agent edit dialog for: æ®µå­é«˜æ‰‹

# 2. ç”¨æˆ·ä¿®æ”¹è®¾ç½®ï¼Œç‚¹å‡»ä¿å­˜
INFO  flowy_ai::agent::event_handler: ğŸ¤– Processing update agent request for: fbe524fc-5fb4-470e-bb0b-c9c98d058860

# 3. è¿›å…¥ update_agent æ–¹æ³•
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] å¼€å§‹æ›´æ–°æ™ºèƒ½ä½“: fbe524fc-5fb4-470e-bb0b-c9c98d058860
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] è¯·æ±‚å·¥å…·åˆ—è¡¨é•¿åº¦: 0
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] è¯·æ±‚æ˜¯å¦åŒ…å« capabilities: true
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] ç°æœ‰æ™ºèƒ½ä½“: æ®µå­é«˜æ‰‹
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] ç°æœ‰å·¥å…·åˆ—è¡¨é•¿åº¦: 0
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] ç°æœ‰ enable_tool_calling: false
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] æ–°èƒ½åŠ›é…ç½® - enable_tool_calling: true
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] æ¡ä»¶æ»¡è¶³ï¼šå·¥å…·è°ƒç”¨å·²å¯ç”¨ä¸”å·¥å…·åˆ—è¡¨ä¸ºç©º
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] æ˜¯å¦éœ€è¦å‘ç°å·¥å…·: true

# 4. å¼€å§‹å·¥å…·å‘ç°
INFO  flowy_ai::ai_manager: âœ¨ [Agent Update] æ£€æµ‹åˆ°å·¥å…·è°ƒç”¨èƒ½åŠ›å˜æ›´æˆ–å·¥å…·åˆ—è¡¨ä¸ºç©ºï¼Œå¼€å§‹è‡ªåŠ¨å‘ç°å·¥å…·...
INFO  flowy_ai::ai_manager: [Tool Discovery] å¼€å§‹æ‰«æ 1 ä¸ª MCP æœåŠ¡å™¨...
INFO  flowy_ai::ai_manager: [Tool Discovery] æ£€æŸ¥æœåŠ¡å™¨: excel-mcp (çŠ¶æ€: Connected)
INFO  flowy_ai::ai_manager: ä» MCP æœåŠ¡å™¨ 'excel-mcp' å‘ç° 20 ä¸ªå·¥å…·
INFO  flowy_ai::ai_manager: å…±ä» 1 ä¸ª MCP æœåŠ¡å™¨å‘ç° 20 ä¸ªå¯ç”¨å·¥å…·

# 5. å¡«å……å·¥å…·å¹¶ä¿å­˜
INFO  flowy_ai::ai_manager: âœ… [Agent Update] ä¸ºæ™ºèƒ½ä½“ 'æ®µå­é«˜æ‰‹' è‡ªåŠ¨å‘ç°äº† 20 ä¸ªå·¥å…·
INFO  flowy_ai::agent::config_manager: Agent updated successfully: æ®µå­é«˜æ‰‹ (fbe524fc-5fb4-470e-bb0b-c9c98d058860)
INFO  flowy_ai::ai_manager: ğŸ”„ [Agent Update] æ›´æ–°å®Œæˆ
INFO  flowy_ai::agent::event_handler: âœ… Successfully updated agent: æ®µå­é«˜æ‰‹ (fbe524fc-5fb4-470e-bb0b-c9c98d058860)
```

## å¦‚æœè¿˜æ˜¯æ²¡æœ‰å·¥å…·å‘ç°æ—¥å¿—

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **å®Œæ•´çš„ `[Agent Update]` æ—¥å¿—**ï¼š
   ```
   ä» "ğŸ”„ [Agent Update] å¼€å§‹æ›´æ–°æ™ºèƒ½ä½“" 
   åˆ° "ğŸ”„ [Agent Update] æ›´æ–°å®Œæˆ"
   ```

2. **MCP æœåŠ¡å™¨çŠ¶æ€**ï¼š
   ```
   åœ¨è®¾ç½®ä¸­æŸ¥çœ‹ MCP æœåŠ¡å™¨åˆ—è¡¨
   - æœåŠ¡å™¨åç§°
   - è¿æ¥çŠ¶æ€ï¼ˆå·²è¿æ¥/æœªè¿æ¥ï¼‰
   - å·¥å…·æ•°é‡
   ```

3. **æ™ºèƒ½ä½“å½“å‰é…ç½®**ï¼š
   - åœ¨å¯¹è¯æ¡†ä¸­çœ‹åˆ°çš„å„ä¸ªå¼€å…³çŠ¶æ€
   - æ˜¯å¦æœ‰å·²å­˜åœ¨çš„å·¥å…·åˆ—è¡¨

## å¿«é€Ÿè§£å†³æ–¹æ¡ˆ

å¦‚æœå·¥å…·å‘ç°ä»ç„¶ä¸è§¦å‘ï¼Œå¯ä»¥å°è¯•ï¼š

### æ–¹æ¡ˆ 1: å¼ºåˆ¶é‡æ–°å‘ç°å·¥å…·

1. æ‰“å¼€æ™ºèƒ½ä½“è®¾ç½®
2. å°†"å·¥å…·è°ƒç”¨"å…³é—­ â†’ ä¿å­˜
3. å†æ¬¡æ‰“å¼€è®¾ç½®ï¼Œå°†"å·¥å…·è°ƒç”¨"æ‰“å¼€ â†’ ä¿å­˜
4. è¿™æ ·ä¼šè§¦å‘èƒ½åŠ›å˜æ›´æ£€æµ‹

### æ–¹æ¡ˆ 2: åˆ é™¤é‡å»º

1. åˆ é™¤ç°æœ‰æ™ºèƒ½ä½“
2. é‡æ–°åˆ›å»ºåŒåæ™ºèƒ½ä½“
3. ç¡®ä¿å¯ç”¨"å·¥å…·è°ƒç”¨"
4. ä¸æ‰‹åŠ¨æ·»åŠ å·¥å…·
5. ä¿å­˜ â†’ åº”è¯¥ä¼šè‡ªåŠ¨å‘ç°å·¥å…·

### æ–¹æ¡ˆ 3: ä½¿ç”¨èŠå¤©æ—¶è‡ªåŠ¨å‘ç°

1. ç›´æ¥ä½¿ç”¨è¯¥æ™ºèƒ½ä½“å¼€å§‹èŠå¤©
2. ç³»ç»Ÿä¼šåœ¨èŠå¤©å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶å‘ç°å·¥å…·
3. è¿™æ˜¯æœ€å¯é çš„å…œåº•æœºåˆ¶

## æµ‹è¯•å®Œæˆåçš„éªŒè¯

æ›´æ–°å®Œæˆåï¼Œå†æ¬¡æ‰“å¼€æ™ºèƒ½ä½“è®¾ç½®ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
- "å·¥å…·è°ƒç”¨" å¼€å…³ï¼šâœ“ å·²å¯ç”¨
- ç³»ç»Ÿå·²è‡ªåŠ¨å¡«å……å·¥å…·åˆ—è¡¨ï¼ˆè™½ç„¶åœ¨ UI ä¸Šå¯èƒ½çœ‹ä¸åˆ°å…·ä½“åˆ—è¡¨ï¼‰

ä½¿ç”¨è¯¥æ™ºèƒ½ä½“èŠå¤©ï¼Œè¯·æ±‚ Excel æ“ä½œï¼š
```
æŸ¥çœ‹ excel æ–‡ä»¶ myfile.xlsx çš„å†…å®¹æœ‰ä»€ä¹ˆ
```

AI åº”è¯¥èƒ½å¤Ÿï¼š
1. è¯†åˆ«éœ€è¦ä½¿ç”¨å·¥å…·
2. è°ƒç”¨ `mcp_excel_read_data_from_excel`
3. æˆåŠŸè¯»å–æ–‡ä»¶å†…å®¹

