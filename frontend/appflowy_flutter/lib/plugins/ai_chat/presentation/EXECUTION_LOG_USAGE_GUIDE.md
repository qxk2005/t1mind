# 执行日志查看器使用指南

## 🎯 功能概述

执行日志查看器现已集成到AppFlowy的AI聊天界面中，用户可以通过简单的点击查看智能体的执行过程。

## 📍 入口位置

### 主要入口：AI消息操作栏

在AI回复消息的操作栏中，您会看到一个新的**执行过程**按钮（🤖图标）：

1. **鼠标悬停显示**：将鼠标悬停在AI消息上时，操作栏会出现
2. **最后消息显示**：对于最新的AI消息，操作栏会始终显示在消息下方
3. **移动端支持**：在移动设备上，长按AI消息会显示操作菜单

### 按钮位置

执行日志按钮位于AI消息操作栏中，顺序为：
- 📋 复制
- 🔄 重新生成  
- 📝 更改格式
- 🤖 更改模型
- **🤖 执行过程** ← 新增按钮
- 💾 保存到页面

## 🚀 使用方法

### 1. 查看执行日志

1. 在AI聊天界面中发送消息
2. 等待AI回复
3. 将鼠标悬停在AI回复消息上
4. 点击操作栏中的**执行过程**按钮（🤖图标）
5. 弹出窗口将显示详细的执行日志

### 2. 日志查看器功能

弹出的执行日志查看器包含以下功能：

#### 🔍 搜索功能
- 在搜索框中输入关键词
- 匹配的内容会高亮显示
- 支持实时搜索

#### 🏷️ 过滤功能
- **按阶段过滤**：规划、执行、工具调用、反思、完成
- **按状态过滤**：进行中、成功、失败、已取消

#### ⚡ 实时更新
- 开启"自动滚动"开关
- 自动显示最新日志
- 定时刷新内容

#### 📊 详细信息
每个日志项显示：
- **执行阶段**：当前执行的阶段
- **执行步骤**：具体的操作描述
- **输入数据**：传入的参数或数据
- **输出结果**：执行的结果
- **执行时间**：开始时间和耗时
- **状态标识**：成功/失败/进行中等状态

## 🎨 界面说明

### 弹出窗口布局

```
┌─────────────────────────────────────────┐
│ 🤖 执行过程                          ✕ │
├─────────────────────────────────────────┤
│ [搜索框] [刷新] [阶段过滤] [状态过滤]    │
│ □ 自动滚动                              │
├─────────────────────────────────────────┤
│ ● 规划阶段 - 分析用户问题         [成功] │
│   输入：用户问题：请帮我创建一个新文档    │
│   输出：识别到用户需要创建文档...        │
│   时间：14:30:25 (2000ms)              │
├─────────────────────────────────────────┤
│ ● 工具调用 - 调用文档创建工具     [成功] │
│   输入：{"title": "新文档", ...}        │
│   输出：{"document_id": "doc_123"...}   │
│   时间：14:30:27 (3000ms)              │
└─────────────────────────────────────────┘
```

### 状态颜色说明

- 🔵 **蓝色**：进行中
- 🟢 **绿色**：成功
- 🔴 **红色**：失败
- 🟠 **橙色**：已取消

## 🔧 技术实现

### 会话ID获取

执行日志查看器会自动从以下来源获取会话ID：

1. **消息元数据**：优先从消息的metadata中获取sessionId
2. **消息ID前缀**：从消息ID中提取会话标识
3. **默认生成**：基于消息ID生成唯一的会话标识

### 数据来源

- **后端API**：优先调用真实的后端执行日志API
- **模拟数据**：当后端不可用时，显示演示数据
- **实时更新**：支持WebSocket或定时轮询获取最新日志

## 🐛 故障排除

### 常见问题

1. **按钮不显示**
   - 确保是AI回复的消息（不是用户消息）
   - 检查消息是否完成加载
   - 尝试刷新页面

2. **日志为空**
   - 检查网络连接
   - 确认后端服务正常
   - 查看浏览器控制台错误信息

3. **搜索不工作**
   - 确保输入了有效的搜索关键词
   - 检查日志内容是否包含搜索词
   - 尝试清空搜索框重新输入

4. **弹窗无法关闭**
   - 点击右上角的关闭按钮（✕）
   - 点击弹窗外部区域
   - 按ESC键（如果支持）

### 性能优化

- 大量日志时会自动分页加载
- 搜索和过滤在前端进行，响应迅速
- 虚拟滚动确保界面流畅

## 📱 移动端支持

在移动设备上：
- 长按AI消息显示操作菜单
- 点击"执行过程"选项
- 全屏显示执行日志查看器
- 支持触摸滚动和缩放

## 🔮 未来功能

计划中的功能增强：
- 导出日志到文件
- 日志性能分析图表
- 执行过程可视化流程图
- 与其他工具的集成

## 💡 使用技巧

1. **快速定位问题**：使用状态过滤快速找到失败的步骤
2. **理解执行逻辑**：按时间顺序查看完整的执行流程
3. **调试智能体**：通过输入输出数据分析智能体行为
4. **性能监控**：关注执行时间，识别性能瓶颈

---

现在您可以在AppFlowy的AI聊天界面中轻松查看智能体的执行过程了！🎉
