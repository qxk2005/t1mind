# 手动测试检查清单 - 任务D5

## 测试前准备

### 环境检查
- [ ] AppFlowy 应用已构建并可正常运行
- [ ] 准备测试用的OpenAI兼容API服务器（推荐：Ollama、LocalAI）
- [ ] 准备测试用API密钥（非生产环境）
- [ ] 确保网络连接正常

### 测试设备
- [ ] Windows 桌面端
- [ ] macOS 桌面端
- [ ] Linux 桌面端
- [ ] Android 移动端
- [ ] iOS 移动端

## 里程碑A：UI与i18n测试

### A1: 全局模型类型选择器
- [ ] 打开 设置 > AI设置
- [ ] 找到"全局使用的模型类型"选择器
- [ ] 验证默认选择为"ollama 本地"
- [ ] 验证下拉选项包含"openai 兼容服务器"
- [ ] 验证选择器可以正常点击和选择
- [ ] 验证选择器样式与其他下拉组件一致

### A2: OpenAI兼容设置面板
- [ ] 选择"openai 兼容服务器"
- [ ] 验证显示OpenAI兼容设置面板
- [ ] 验证聊天配置区域包含以下字段：
  - [ ] API端点（默认：https://api.openai.com/v1）
  - [ ] API密钥（遮蔽显示）
  - [ ] 模型名称（默认：gpt-3.5-turbo）
  - [ ] 模型类型（默认：chat）
  - [ ] 最大Tokens（默认：4096）
  - [ ] 温度（默认：0.7）
  - [ ] 请求超时（默认：30）
- [ ] 验证嵌入配置区域包含以下字段：
  - [ ] API端点（默认：https://api.openai.com/v1）
  - [ ] API密钥（遮蔽显示）
  - [ ] 模型名称（默认：text-embedding-ada-002）
- [ ] 验证所有字段可以正常输入
- [ ] 验证API密钥字段正确遮蔽显示
- [ ] 验证字段提示文本正确显示

### A3: Tab切换逻辑
- [ ] 在"ollama 本地"和"openai 兼容服务器"之间切换
- [ ] 验证选择"ollama 本地"时显示LocalAISetting面板
- [ ] 验证选择"openai 兼容服务器"时显示OpenAICompatibleSetting面板
- [ ] 验证切换过程无错误或闪烁
- [ ] 验证切换后面板内容正确

### A4: 移动端设置入口
- [ ] 在移动端设备上打开AppFlowy
- [ ] 导航到AI设置页面
- [ ] 验证全局模型类型选择功能可用
- [ ] 验证移动端UI适配正确
- [ ] 验证触摸交互正常

### A5: 基础i18n文案
- [ ] 切换到中文界面
- [ ] 验证以下中文文案正确显示：
  - [ ] "全局使用的模型类型"
  - [ ] "ollama 本地"
  - [ ] "openai 兼容服务器"
  - [ ] "聊天配置"
  - [ ] "嵌入配置"
  - [ ] "API端点"
  - [ ] "API密钥"
  - [ ] "模型名称"
  - [ ] "保存设置"
  - [ ] "测试聊天"
  - [ ] "测试嵌入"
- [ ] 切换到英文界面
- [ ] 验证对应英文文案正确显示
- [ ] 验证无缺失或错误的翻译

## 里程碑B：持久化测试

### B1-B6: 配置保存和读取
- [ ] 选择"openai 兼容服务器"
- [ ] 填写测试配置：
  - [ ] 聊天API端点：`http://localhost:11434/v1`
  - [ ] 聊天API密钥：`test-key-123`
  - [ ] 聊天模型名称：`llama2`
  - [ ] 嵌入API端点：`http://localhost:11434/v1`
  - [ ] 嵌入API密钥：`test-key-123`
  - [ ] 嵌入模型名称：`nomic-embed-text`
- [ ] 点击"保存设置"按钮
- [ ] 验证显示成功保存提示
- [ ] 刷新页面或重新打开设置
- [ ] 验证全局模型类型保持为"openai 兼容服务器"
- [ ] 验证所有配置字段值正确保存
- [ ] 完全关闭应用
- [ ] 重新启动应用
- [ ] 打开AI设置页面
- [ ] 验证配置在重启后仍然保持

## 里程碑C：测试能力测试

### C1-C6: 连接测试功能

#### 成功场景测试
- [ ] 确保有可用的OpenAI兼容API服务器运行
- [ ] 配置正确的API端点和密钥
- [ ] 点击"测试聊天"按钮
- [ ] 验证按钮状态变为"测试中..."
- [ ] 等待测试完成
- [ ] 验证显示绿色成功提示
- [ ] 验证显示响应时间信息
- [ ] 点击"详情"查看完整测试信息
- [ ] 验证详情对话框显示：
  - [ ] 基本信息（状态、响应时间、HTTP状态码）
  - [ ] 请求详情
  - [ ] 服务器响应
- [ ] 点击"测试嵌入"按钮
- [ ] 重复上述验证步骤

#### 错误场景测试
- [ ] 配置无效的API端点（如`http://invalid-url`）
- [ ] 点击"测试聊天"
- [ ] 验证显示红色错误提示
- [ ] 验证错误信息用户友好（不包含技术细节）
- [ ] 测试不同错误类型：
  - [ ] 网络连接错误
  - [ ] 认证错误（错误API密钥）
  - [ ] 模型不存在错误
  - [ ] 超时错误
- [ ] 验证每种错误都有相应的本地化提示
- [ ] 验证错误详情对话框显示完整错误信息

#### 测试结果UI验证
- [ ] 验证测试结果显示区域布局正确
- [ ] 验证成功结果使用绿色主题
- [ ] 验证失败结果使用红色主题
- [ ] 验证测试中状态使用中性主题
- [ ] 验证可以关闭测试结果显示
- [ ] 验证多次测试结果正确更新

## 里程碑D：全局生效测试

### D1-D4: 全局路由切换

#### 聊天路由测试
- [ ] 设置全局模型类型为"openai 兼容服务器"
- [ ] 配置有效的OpenAI兼容设置
- [ ] 打开AI聊天功能
- [ ] 发送一条测试消息
- [ ] 验证消息发送成功
- [ ] 检查应用日志，确认请求路由到OpenAI兼容服务器
- [ ] 切换全局模型类型为"ollama 本地"
- [ ] 再次发送消息
- [ ] 检查日志，确认请求路由到本地AI

#### 嵌入路由测试
- [ ] 设置全局模型类型为"openai 兼容服务器"
- [ ] 尝试文档嵌入功能
- [ ] 检查日志，确认嵌入请求路由到OpenAI兼容服务器
- [ ] 切换回"ollama 本地"
- [ ] 再次尝试嵌入
- [ ] 检查日志，确认请求路由到本地AI

#### 流式聊天测试
- [ ] 使用OpenAI兼容配置
- [ ] 发送较长的聊天请求
- [ ] 验证响应是流式返回（逐字显示）
- [ ] 验证流式体验与本地AI一致
- [ ] 验证可以中断流式响应

#### 错误回退测试
- [ ] 配置无效的OpenAI兼容服务器
- [ ] 发送聊天请求
- [ ] 验证自动回退到本地AI（如果可用）
- [ ] 检查日志，确认回退逻辑正确执行

## 跨平台一致性测试

### 每个平台验证以下项目：

#### Windows 桌面端
- [ ] UI显示正确
- [ ] 所有功能正常
- [ ] 配置保存正确
- [ ] 测试功能工作
- [ ] 全局路由正确

#### macOS 桌面端
- [ ] UI显示正确
- [ ] 所有功能正常
- [ ] 配置保存正确
- [ ] 测试功能工作
- [ ] 全局路由正确

#### Linux 桌面端
- [ ] UI显示正确
- [ ] 所有功能正常
- [ ] 配置保存正确
- [ ] 测试功能工作
- [ ] 全局路由正确

#### Android 移动端
- [ ] UI适配正确
- [ ] 触摸交互正常
- [ ] 功能与桌面端一致
- [ ] 配置同步正确

#### iOS 移动端
- [ ] UI适配正确
- [ ] 触摸交互正常
- [ ] 功能与桌面端一致
- [ ] 配置同步正确

## 安全性验证

### API密钥安全
- [ ] 输入API密钥后验证字段遮蔽显示
- [ ] 保存配置后重新打开，验证密钥仍然遮蔽
- [ ] 检查配置文件，确认密钥加密存储
- [ ] 验证密钥不以明文形式存储在任何地方

### 日志安全
- [ ] 开启应用日志记录
- [ ] 执行各种操作（保存配置、测试连接等）
- [ ] 检查日志文件
- [ ] 验证API密钥在日志中已脱敏
- [ ] 验证敏感信息不泄露到日志

### 网络安全
- [ ] 使用网络监控工具查看HTTP请求
- [ ] 验证API密钥在请求头中正确传输
- [ ] 验证HTTPS连接正常工作
- [ ] 验证证书验证正确

## 性能验证

### 响应时间
- [ ] UI切换响应时间 < 100ms
- [ ] 配置保存时间 < 1s
- [ ] 测试连接时间合理（取决于网络和服务器）
- [ ] 页面加载时间正常

### 资源使用
- [ ] 监控内存使用，确保无异常增长
- [ ] 监控CPU使用，确保正常范围
- [ ] 监控网络请求，确保合理
- [ ] 验证无内存泄漏

## 回归测试

### 现有功能验证
- [ ] 本地AI功能正常工作
- [ ] 原有聊天功能无影响
- [ ] 原有嵌入功能无影响
- [ ] 其他AI相关功能正常
- [ ] 非AI功能无影响
- [ ] 应用启动和关闭正常

## 边界条件测试

### 输入验证
- [ ] 测试空白输入
- [ ] 测试超长输入
- [ ] 测试特殊字符输入
- [ ] 测试无效URL格式
- [ ] 测试负数和零值输入

### 网络条件
- [ ] 测试网络断开情况
- [ ] 测试网络缓慢情况
- [ ] 测试服务器超时情况
- [ ] 测试并发请求情况

## 用户体验验证

### 易用性
- [ ] 新用户能够轻松找到设置入口
- [ ] 配置流程直观易懂
- [ ] 错误提示清晰有用
- [ ] 成功反馈及时明确

### 一致性
- [ ] UI风格与应用整体一致
- [ ] 交互模式与其他功能一致
- [ ] 文案风格统一
- [ ] 图标和颜色使用一致

## 测试完成检查

### 必须通过项（阻塞发布）
- [ ] 所有UI功能正常显示和交互
- [ ] 配置能正确保存和读取
- [ ] 测试功能返回正确结果
- [ ] 全局路由切换工作正常
- [ ] API密钥安全存储
- [ ] 无功能回归
- [ ] 至少一个平台完全通过测试

### 应该通过项（建议修复）
- [ ] 所有目标平台功能一致
- [ ] 性能表现良好
- [ ] 错误提示用户友好
- [ ] 国际化完整
- [ ] 用户体验良好

### 可以接受项（后续优化）
- [ ] UI细节优化空间
- [ ] 性能进一步优化空间
- [ ] 更多错误场景覆盖
- [ ] 更多语言支持

## 测试记录

### 测试信息
- 测试日期：____________
- 测试人员：____________
- AppFlowy版本：____________
- 测试环境：____________

### 问题记录
如发现问题，请记录：

**问题1：**
- 描述：
- 重现步骤：
- 预期结果：
- 实际结果：
- 严重程度：□ 阻塞 □ 严重 □ 一般 □ 轻微
- 截图/日志：

**问题2：**
- 描述：
- 重现步骤：
- 预期结果：
- 实际结果：
- 严重程度：□ 阻塞 □ 严重 □ 一般 □ 轻微
- 截图/日志：

### 测试总结
- 总测试项：______
- 通过项：______
- 失败项：______
- 通过率：______%

### 验收结论
- [ ] ✅ 验收通过 - 所有必须项通过，可以发布
- [ ] ⚠️ 条件通过 - 大部分功能正常，建议修复后发布
- [ ] ❌ 验收失败 - 存在阻塞问题，需要修复后重新测试

### 备注
_其他需要说明的问题或建议_
